# Сервис управления рассылками

## Описание

Проект представляет из себя сервис, который по заданным правилам запускает
рассылку по списку клиентов. После создания новой рассылки, если текущее время
больше времени начала и меньше времени окончания, то из справочника выбираются
все клиенты, которые подходят под значения фильтра, указанного в этой рассылке
и запускается отправка сообщений для всех этих клиентов. Если создаётся
рассылка с временем старта в будущем, то отправка переносится до наступления
этого времени и в автоматическом режиме запускается. По всем сообщениям
собирается статистика, которую можно получить и использовать для формирования
отчётов. В данном проекте используется внешний сервис, который принимает
запросы на отправку сообщений в сторону клиентов. Проблемы с внешним сервисом
не влияют на стабильность работы разработанного сервиса рассылок. Проект
состоит из бэкенд-приложения на _Django_, _Celery_ и _Redis_ для асинхронной
обработки задач в фоновом режиме.

## Дополнительные особенности продукта

- [x] Тестирование эндпоинтов и формирования рассылки;

- [x] Организовано тестирование написанного кода c помощью _GitHub Actions_
при пуше в ветку _main_;

- [x] Подготовлен _docker-compose_ файл для запуска всех сервисов проекта
одной командой;

- [x] По адресу <домен>/docs/ открывается страница со _Swagger UI_, в котором
отображается описание разработанного _API_;

- [x] Обеспечено подробное логирование на всех этапах обработки запросов,
чтобы при эксплуатации была возможность найти в логах всю информацию.

## Технологии

- Python 3.10.12;
- PostgreSQL 14;
- Django 4.2.5;
- Django REST framework 3.14.0;
- Gunicorn 21.2.0;
- Nginx 1.22.1;
- Celery 5.3.4;
- Redis 5.0.1.

## Запуск приложения локально в docker-контейнерах

Инструкция написана для компьютера с установленной _ОС Windows_ 10 или 11.

- Установите _Windows Subsystem for Linux_ по инструкции с официального сайта
[Microsoft](https://learn.microsoft.com/ru-ru/windows/wsl/install);

- Зайдите на
[официальный сайт Docker](https://www.docker.com/products/docker-desktop/),
скачайте и установите файл _Docker Desktop_;

- В корне проекта создайте .env файл и заполните следующими данными:

  - в переменной `POSTGRES_DB` должно быть название базы данных;

  - в переменной `POSTGRES_USER` должно быть имя пользователя БД;

  - в переменной `POSTGRES_PASSWORD` должен быть пароль пользователя БД;

  - в переменной `DB_HOST` должен быть адрес, по которому _Django_ будет
  соединяться с базой данных;

  - в переменной `DB_PORT` должен быть порт, по которому _Django_ будет
  обращаться к базе данных;

  - в переменную `SECRET_KEY` укажите секретный ключ для конкретной установки
  _Django_;

  - в переменную `DEBUG` укажите значение режима отладки;

  - в переменную `ALLOWED_HOSTS` укажите список строк, представляющих имена
  хоста/домена, которые может обслуживать это _Django_ приложение;

  - в переменные `CELERY_BROKER_URL` и `CELERY_RESULT_BACKEND` укажите _URL_-
  адреса, на которые будут отправляться сообщения и записываться результаты;

  - в переменную `URL` укажите _URL_-адрес внешнего сервиса, который принимает
  запросы на отправку сообщений в сторону клиента;

  - в переменную `TOKEN` укажите токен аутентификации внешнего сервиса.

- В терминале в папке с `docker-compose.yml` выполните команду:

```text
docker compose up
```

- Перейдите в новом терминале в директорию, где лежит файл
`docker-compose.yml`, и выполните команды:

```text
docker compose exec backend python manage.py migrate
docker compose exec backend python manage.py collectstatic
docker compose exec backend cp -r /app/collected_static/. /backend_static/static/
```

- На странице `<домен>/docs/` можно ознакомиться с документацией проекта.

## Автор

Пилипенко Артем
